# 成绩导入转换工具

基于 PySide6 的现代化 GUI 工具，用于处理和转换学生成绩 Excel 文件。

## 功能特性

- ✅ 输入2个工作表，自动生成8个标准工作表
- ✅ 自动合并两次考试数据
- ✅ 筛选尖子生（排名前20）
- ✅ 计算两次考试排名均值
- ✅ 支持按姓名或均值排序
- ✅ 现代化图形界面
- ✅ 实时处理进度显示
- ✅ 详细的文件信息预览

## 技术栈

- **GUI框架**: PySide6 (Qt for Python)
- **Excel处理**: xlrd (读取) + xlwt (写入)
- **数据分析**: 基于项目实际数据结构分析

## 安装依赖

```bash
pip install -r requirements.txt
```

## 使用方法

### 启动程序

```bash
python score_import_gui.py
```

### 操作步骤

1. **选择输入文件**
   - 点击"选择文件"按钮
   - 选择类似 `22高二期中.xls` 格式的 Excel 文件
   - 程序会自动分析文件结构并显示信息

2. **设置输出路径**（可选）
   - 点击"设置路径"按钮自定义输出文件位置
   - 默认会在输入文件同目录生成 `原文件名_转换.xls`

3. **开始转换**
   - 点击"开始转换"按钮
   - 等待处理完成
   - 查看处理日志确认结果

## 支持的文件格式

### 输入格式

输入文件必须包含**两个工作表**：`高二一调` 和 `高二期中`

**表头结构**（可混合）：
```
行1: [空] | 姓名 | 语文 | [校次/空] | 数学 | [校次/空] | ...
行2: [可能是标签行或数据行]
行3+: 学生数据
```

**列结构**（固定16列）：
- 列1: 考试名称
- 列2: 姓名
- 列3-14: 各科成绩和校次交替（语文、数学、英语、物理、化学、生物）
- 列15-16: 总分和总校次

### 输出格式

生成**8个工作表**的标准格式文件：

| 工作表 | 说明 | 行数 |
|--------|------|------|
| 1. 历次成绩原始 | 合并两次考试数据 | 110+ |
| 2. 历次成绩打印 | 合并两次考试数据 | 110+ |
| 3. 尖子生成绩 | 排名前20的学生 | 22 |
| 4. 高一期末 | 空表（仅表头） | 2 |
| 5. 高二一调 | 原始数据复制 | 56 |
| 6. 高二期中 | 原始数据复制 | 56 |
| 7. 均值 姓名排序 | 两次排名均值，按姓名排序 | 56 |
| 8. 两次 均值 升序 | 两次排名均值，按均值升序 | 56 |

## 文件结构

```
handle_score/
├── score_import_gui.py      # 主程序（GUI）
├── excel_handler.py          # Excel 处理核心模块
├── requirements.txt          # 依赖列表
├── README.md                 # 本文件
├── data/                     # 测试数据目录
│   ├── 22历次成绩.xls
│   ├── 22高二一调.xls
│   └── 22高二期中.xls
└── *.md                      # 分析文档
```

## 核心模块说明

### excel_handler.py

**ExamSheet 类**
- 封装单个工作表的数据
- 解析学生成绩信息
- 提供数据访问接口

**ExcelHandler 类**
- `detect_header_structure()` - 自动检测表头结构
- `read_excel_file()` - 读取 Excel 文件
- `write_excel_file()` - 写入 Excel 文件
- `get_file_info()` - 获取文件详细信息

### score_import_gui.py

**MainWindow 类**
- 主窗口界面
- 文件选择和预览
- 处理流程控制

**ProcessThread 类**
- 后台处理线程
- 避免界面卡顿
- 实时进度反馈

## 数据处理逻辑

### 工作表生成规则

**工作表1-2（历次成绩原始/打印）**
- 合并两个输入工作表的所有数据
- 保持原始表头和标签行
- 先写高二一调数据，再写高二期中数据

**工作表3（尖子生成绩）**
- 从高二一调中筛选排名前20的学生
- 按总校次排序

**工作表4（高一期末）**
- 仅包含表头和标签行
- 无实际数据

**工作表5-6（高二一调/期中）**
- 直接复制输入工作表数据

**工作表7-8（均值排序）**
- 提取两次考试的总分和总校次
- 计算排名均值：(高二一调排名 + 高二期中排名) / 2
- 工作表7按姓名排序，工作表8按均值升序排列

## 注意事项

1. **文件格式**
   - 仅支持 `.xls` 格式（旧版 Excel）
   - 如需处理 `.xlsx` 文件，请先转换为 `.xls`

2. **数据完整性**
   - 程序会保持原始数据不变
   - 不会修改或删除任何数据

3. **表头识别**
   - 自动识别单层/双层表头
   - 无需人工指定格式

## 已知问题

- [ ] 暂不支持 `.xlsx` 格式的直接读写（xlwt 限制）
- [ ] 大文件处理速度待优化

## 未来计划

- [ ] 支持 `.xlsx` 格式
- [ ] 数据验证和错误检查
- [ ] 批量文件处理
- [ ] 数据统计和分析功能
- [ ] 导出报表功能

## 开发日志

- **v1.0** (2025-11-20)
  - ✅ 基础 GUI 界面
  - ✅ 文件导入导出功能
  - ✅ 自动表头识别
  - ✅ 文件信息预览

## 许可证

本项目仅供学习和内部使用。
